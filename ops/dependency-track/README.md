# Dependency-Track (Ops bundle)

AGENT_HOOK: dependency-management

## What this is

Lightweight, self-contained deployment scaffolding for OWASP Dependency-Track so we can ingest Syft-generated SBOMs from this superrepo and visualise risk across projects.

## Quickstart (local/dev)

1. Copy `.env.example` to `.env` and set a strong `DT_ADMIN_PASSWORD`. Keep this file off GitHub; store it on the SSH-accessible host or secrets manager.
2. Start the stack:

   ```bash
   docker compose -f ops/dependency-track/docker-compose.yml up -d
   ```

   - API: http://localhost:8081
   - UI: http://localhost:8080

3. Log in with `admin` / `DT_ADMIN_PASSWORD`, create an API key, and keep it locally (e.g., `DEPENDENCY_TRACK_API_KEY` in `.env` on the host). This keeps credentials out of GitHub.

> Co-locating services: If you already run other project containers (e.g., n00menon) on the same host, you can reuse this compose file by adding additional services; keep Dependency-Track volumes isolated and bind ports explicitly to avoid clashes.

## How CI uploads SBOMs

- SBOMs are generated by `.dev/automation/scripts/deps-sbom.sh` (see `.github/workflows/sbom.yml`).
- Uploads are handled by `.dev/automation/scripts/deps-dependency-track-upload.sh` when these secrets are present:
  - `DEPENDENCY_TRACK_BASE_URL` (e.g., `https://dtrack.example.com`)
  - `DEPENDENCY_TRACK_API_KEY` (BOM upload scope)
- Projects are named using `ops/dependency-track/projects.json` (`n00tropic-cerebrum::<target>`) to mirror the workspace manifest.

## Production notes

- For hardening, swap the default H2 database for Postgres by setting `DT_DATABASE_URL` and `DT_DATABASE_DRIVER` envs and adding a Postgres service to the compose file.
- Frontend `API_BASE_URL` must match the externally reachable API host/port (defaults to `http://localhost:8081`).
- Backups: persist `./data` volume (contains DB + uploads). Snapshots should exclude SBOM artifacts already stored in CI.

## Paths to remember

- Compose file: `ops/dependency-track/docker-compose.yml`
- Project map: `ops/dependency-track/projects.json`
- Upload script: `.dev/automation/scripts/deps-dependency-track-upload.sh`
