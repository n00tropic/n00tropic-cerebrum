= Documentation contribution guide
:page-tags: diataxis:reference, domain:platform, audience:contrib, stability:beta
:reviewed: 2025-11-11
:toc:
:toclevels: 2

== Overview

The n00 Cerebrum documentation uses https://docs.antora.org/[Antora] to build a
multi-repository documentation site. All documentation follows the
https://diataxis.fr/[Di치taxis framework] for structured technical documentation.

== Di치taxis Framework

Di치taxis divides documentation into four distinct modes:

* **Tutorial** - Learning-oriented, greenfield walk-throughs (for example, provisioning
 frontier workspaces)
* **How-to Guide** - Task-oriented, focused jobs with clear outcomes (for example,
 running ERPNext exports)
* **Reference** - Information-oriented, exhaustive configuration, API schemas, CLI
 flags
* **Explanation** - Understanding-oriented, architecture notes, ADRs, and
 rationale
When creating or editing documentation, always classify your content according
to these modes.

== Page Requirements

Every asciidoc page must include the following attributes in the header:

[source,asciidoc]
----
= Page Title
:page-tags: diataxis:<tutorial|howto|reference|explanation>, domain:<product|platform|ops>, audience:<user|operator|agent|contrib>, stability:<draft|beta|stable>
:reviewed: YYYY-MM-DD
----

=== Tag Taxonomy

==== Di치taxis Tags
* `diataxis:tutorial` - Step-by-step learning guides
* `diataxis:howto` - Problem-solving guides
* `diataxis:reference` - Technical specifications
* `diataxis:explanation` - Conceptual explanations

==== Domain Tags
* `domain:product` - End-user product features
* `domain:platform` - Platform and infrastructure
* `domain:ops` - Operational procedures

==== Audience Tags
* `audience:user` - End users
* `audience:operator` - System operators
* `audience:agent` - AI agents
* `audience:contrib` - Contributors

==== Stability Tags
* `stability:draft` - Work in progress
* `stability:beta` - Under review
* `stability:stable` - Production ready

=== Review SLA

Documentation pages must be reviewed at least every **90 days**. Update the `:reviewed:` date when:

* Content is verified as current
* Links are checked and working
* Code examples are tested
* Technical accuracy is confirmed

The ci pipeline fails if pages have stale review dates (>90 days).

== Snippet Tagging

To prevent documentation drift, reference live code and configuration files using tagged regions:

.In source file (example: scripts/example.sh)
[source,bash]
----
# tag::snippet-example[]
n00 --help
# end::snippet-example[]
----

.In documentation file
[source,asciidoc]
----
\include::../../../../scripts/example.sh[tags=snippet-example]
----

This ensures documentation stays synchronized with actual code.

== Partials for Reusable Content

Factor repeated content into partials under `docs/modules/ROOT/partials/`:

[source,asciidoc]
----
\include::partial$common-warning.adoc[]
----

== Writing Style

* Use Oxford English spelling
* Write in present tense
* Use active voice
* Keep sentences concise
* Avoid gerunds in headings (enforced by Vale)
* Use code blocks for commands and outputs
* Include examples and screenshots where helpful

== Ci/CD checks

All documentation PRs are validated against:

|===
| Check | Purpose

| **Vale**
| Prose linting for style and terminology

| **asciidoc parse**
| ascidoctor check for syntax errors (skips Antora resource includes like `partial$`)

| **Lychee**
| Link checking

| **Attribute checks**
| Validates presence of `:page-tags:` and `:reviewed:`

| **DangerJS**
| PR policy enforcement

| **Antora build**
| Ensures the site builds successfully
|===

=== Local Development

==== Building the docs

[source,bash]
----
# Install Antora and extensions (pnpm)
corepack enable
corepack prepare pnpm@10.28.2 --activate
pnpm install --frozen-lockfile

# Verify locally installed Antora (use workspace installation or the n00plicate repo)
pnpm exec antora --version

# Build the site
pnpm exec antora-playbook.yml

# View the output
open build/site/index.html
----

==== Running validation

[source,bash]
----
# Check attributes
node scripts/check-attrs.mjs

# Run Vale (local) (recommended for lightweight checks):
# Use the local style focused on n00 rules
#
# make setup-vale-local
# VALE_LOCAL=1 make validate-docs
#
# To run the full Vale check (ci-style) with third-party styles (Google/Microsoft), sync styles first:
# make vale-sync
# vale docs

# Check links (requires Lychee CLI installed)
lychee --config .lychee.toml 'docs/**/*.adoc'
----

== Navigation Structure

Update `docs/modules/ROOT/nav.adoc` when adding new pages. Organize navigation
hierarchically using Antora's xref syntax:

[source,asciidoc]
----
* xref:index.adoc[Home]
** xref:getting-started.adoc[Getting Started]
** xref:tutorials/first-steps.adoc[First Steps Tutorial]
----

== Markdown to asciidoc Conversion

When converting existing Markdown documentation:

[source,bash]
----
# Using kramdown-asciidoc (recommended)
kramdoc -o docs/modules/ROOT/pages/converted.adoc original.md

# Or using Pandoc -f markdown -t asciidoc -o converted.adoc original.md
----

After conversion:
1. Add required page attributes (`:page-tags:`, `:reviewed:`)
2. Fix any formatting issues
3. Update internal links to use xref syntax
4. Test the build

== Search and Indexing

=== Offline Search (Lunr)

Antora automatically generates a Lunr search index during build. The index includes:
* Page content
* Page titles
* Page tags
* Metadata

=== Production Search (Algolia DocSearch)

For production deployments, Algolia DocSearch provides enhanced search capabilities. The crawler runs automatically on GitHub Pages deployments.

== Diagrams

The workspace supports multiple diagram types via Kroki, including Mermaid, PlantUML, GraphViz, C4, BPMN, and more. Diagrams are rendered server-side during Antora build.

=== Mermaid Diagrams

Mermaid is ideal for flowcharts, sequence diagrams, class diagrams, and state diagrams.

[source,asciidoc]
----
[mermaid]
....
graph TD
    A[Start] --> B{Decision}
    B -->|Yes| C[Do Something]
    B -->|No| D[Do Something Else]
    C --> E[End]
    D --> E
....
----

=== PlantUML Diagrams

PlantUML is suitable for UML diagrams, including component, deployment, and activity diagrams.

[source,asciidoc]
----
[plantuml]
....
@startuml
actor User
User -> System : Request
System -> Database : Query
Database -> System : Result
System -> User : Response
@enduml
....
----

=== GraphViz Diagrams

GraphViz (DOT) is powerful for directed and undirected graphs, network diagrams, and dependency trees.

[source,asciidoc]
----
[graphviz]
....
digraph G {
    rankdir=LR;
    A -> B;
    B -> C;
    C -> D;
    D -> A;
}
....
----

=== C4 Architecture Diagrams

C4 diagrams visualize software architecture at different levels: Context, Container, Component, and Code.

[source,asciidoc]
----
[c4plantuml]
....
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

Person(user, "User")
System(system, "System")
user -> system : Uses
@enduml
....
----

=== Diagram Best Practices

* **Keep diagrams simple** - Focus on clarity over complexity
* **Use consistent styling** - Follow workspace color schemes where possible
* **Add alt text** - Use `[alt=Description]` for accessibility
* **Version control diagrams** - Store diagram source in docs, not just rendered images
* **Test rendering** - Always build docs locally to verify diagram output

=== Kroki Configuration

Diagrams are rendered using the public Kroki service (`https://kroki.io`). For air-gapped environments, configure a self-hosted Kroki instance:

[source,yaml]
----
# antora-playbook.yml
asciidoc:
  attributes:
    kroki-server-url: http://localhost:8000
    kroki-fetch-diagram: true
----

Refer to https://docs.kroki.io/kroki/setup/install/[Kroki installation docs] for self-hosting instructions.

== Model Context Protocol docs server (optional)

For AI agent access, run the MCP docs server:

[source,bash]
----
make mcp-dev
----

This provides three Tools:
* `search(query)` - Full-text search
* `get_page(id)` - Retrieve page content
* `list_tags()` - List all available tags

== Questions and Support

For questions about documentation:
* Open an issue in the repository
* Ask in the #docs channel
* Review existing ADRs in `docs/modules/ROOT/pages/1. Cerebrum Docs/ADR/`
