= Adaptive Planning & Typesense Rollout
:page-tags: diataxis:reference, domain:platform, audience:operator, stability:beta
:reviewed: 2025-11-19

[abstract]
This page captures the Codex planning initiative status, the split between workstreams, and pointers to operational docs (ADR-005, `docs/PLANNING.md`, search instructions, and PM templates).

== Decision Log

* Workspace ADR: xref:++1. Cerebrum Docs/ADR/ADR-005-adaptive-planning-and-typesense.md++ clarifies scope, guardrails, and follow-up questions.
* Planner outputs must exist before merging any brief/issue PR; CI enforces DRY/YAGNI thresholds via `.github/workflows/planner.yml`.
* Typesense replaces Algolia as the primary search backend (OSS container preferred, hosted endpoints optional via env overrides).

== Workstreams

[%autowidth,cols="1,1,2"]
|===
| Workstream | Lead | Focus
| Planning runtime | n00t maintainers | `n00t/planning/`, MCP capability, `.plan.md` artefacts, automation scripts
| PM + telemetry | Horizons + School | Experiment templates (`[[PLAN]]`), AGENT_E2E updates, planner pipeline (`pipelines/planner-v1.yml`)
| Docs + search | Docs guild | Antora migration, Typesense README/config, docsearch workflow, nav + MCP server updates
|===

== Local Typesense recipe

. Install Docker/Podman locally.
. Copy `docs/search/docsearch.typesense.env.example` to `.env`, edit the API key, then run `pnpm exec antora antora-playbook.yml`.
. Serve the docs (`npx http-server build/site -p 8080 & echo $! > docs/search/logs/http.pid`) and bring up Typesense via `docker compose -f docs/search/typesense-compose.yml up -d`.
. Execute the scraper via Docker (Linux can use `--network host`; macOS/WSL should reuse the compose network and add `host.docker.internal`):

```bash
CONFIG=$(node -e "const fs=require('fs');const c=JSON.parse(fs.readFileSync('docsearch.config.json','utf8'));process.stdout.write(JSON.stringify(c));")
docker run --rm --network host \
  -e CONFIG="$CONFIG" \
  -e TYPESENSE_API_KEY=$(grep TYPESENSE_API_KEY docs/search/.env | cut -d= -f2-) \
  -e TYPESENSE_HOST=127.0.0.1 \
  -e TYPESENSE_PORT=8108 \
  -e TYPESENSE_PROTOCOL=http \
  typesense/docsearch-scraper:0.9.0 | tee docs/search/logs/typesense-reindex-$(date +%Y%m%d).log
```

. Stop the HTTP server (`kill $(cat docs/search/logs/http.pid)`) and tear down the compose stack. Repeat inside CI via `search-reindex.yml` when secrets exist.

Remote deployments can override `TYPESENSE_HOST/TYPESENSE_PROTOCOL` via secrets without changing the compose file.

== Progress tracker

* Status table: xref:migration-status.adoc[] for repo-by-repo Antora coverage.
* Planning backlog: `docs/PLANNING.md` enumerates milestones + checklist.
* PM integration: n00-horizons templates (xref:++n00-horizons/docs/modules/ROOT/pages/templates/experiment-brief.adoc++[]) expose the `[[PLAN]]` anchor for planners.
* Typesense runs: `docs/search/logs/typesense-reindex-20251119.log` (and `.log.json` summary) archives the latest Dockerised scrape (37 indexed records).
* Learning log: xref:++n00-school/docs/modules/ROOT/pages/learning-log.adoc++[] documents planner telemetry + formatter fixes for audits.
* Deterministic plan artefacts: `n00-horizons/scripts/generate-experiment-plans.sh` regenerates `.plan.md` files committed under `n00-horizons/docs/experiments/`.

== Next steps

. Call `n00-horizons/scripts/generate-experiment-plans.sh` from automation (e.g., `project-control-panel.sh`) so `.plan.md` artefacts refresh alongside telemetry snapshots.
. Schedule nightly `n00t school.trainingRun planner-v1 --dataset planner-v1` once the telemetry backlog grows and publish the DRY/YAGNI trend to the control panel.
. Consume the generated `docs/search/logs/*.log.json` files so dashboards/control panel can display search freshness without manual edits.
. Replace the remaining Markdown-only references with Antora-native shims to close out the migration tracker âœ… column.
