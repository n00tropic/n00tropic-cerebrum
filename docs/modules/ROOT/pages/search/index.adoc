= Search operations
:page-tags: diataxis:howto, domain:platform, audience:operator, stability:beta
:reviewed: 2025-11-18
// vale Vale.Terms = NO

== Modes

* **Offline / local builds**: Antora emits Lunr indexes automatically when you run
 the docs playbook command documented in xref:README.adoc[]. Confirm
 `build/site/search-index.js` exists.
* **Typesense (preferred)**: Launch the local container via
 `docs/search/typesense-compose.yml` or target a remote Typesense cluster.
 Run the DocSearch scraper (`docsearch.config.json`) to seed collections with
 page metadata (see `docs/search/README.adoc`).
* **Algolia (legacy)**: Historical crawler remains available but is no longer the
 default; keep configuration in sync only if you still serve the previous index.

[#Typesense]
== Re-index steps (Typesense)

. Build docs: `pnpm exec antora antora-playbook.yml`.
. Serve `build/site` locally (`npx http-server build/site -p 8080`).
. Export environment variables from `docs/search/.env` and run the Typesense
 compose stack.
. Execute `pnpm exec docsearch ./docsearch.config.json` (or trigger
 `.github/workflows/search-reindex.yml`).
. Stop the HTTP server + Typesense container when complete.

== Troubleshooting

* If Lunr search returns no hits, delete `build/site` and rebuild to ensure stale
 indexes are removed.
* When Algolia misses fresh content, double-check that pages declare `:page-tags:`
 and `:reviewed:`. Missing attributes are rejected by the crawler.
 * For hackable offline experiments, point your browser at `build/site/index.html`
 and inspect the `window.antoraLunrIndex` payload.

// vale Vale.Terms = YES
