= Typesense Search Runbook
:page-tags: diataxis:howto, domain:platform, audience:operator, stability:beta
:reviewed: 2025-11-19

This page summarises the OSS-first Typesense deployment. See `docs/search/README.adoc` for the full playbook.

== Modes

* **Offline** – Antora + Lunr (already enabled via `antora-playbook.yml`).
* **Local Typesense** – Preferred for development; launch a container with the compose file in `docs/search` and run the DocSearch scraper.
* **Remote Typesense** – Optional shared cluster; override `TYPESENSE_HOST`, `TYPESENSE_PROTOCOL`, and `TYPESENSE_PORT` via secrets in CI.

== Prerequisites

. Docker or Podman.
. Node 20+ (DocSearch scraper) plus pnpm-installed Antora dependencies.
. `docs/search/docsearch.typesense.env.example` copied to `.env` with a generated API key.

== Local Container Steps

```bash
cp docs/search/docsearch.typesense.env.example docs/search/.env
npm install --global @typesense/docsearch-scraper || pnpm exec npx @typesense/docsearch-scraper --version
cd docs/search
TYPESENSE_API_KEY=$(grep TYPESENSE_API_KEY .env | cut -d= -f2-)
docker compose -f typesense-compose.yml up -d
cd -
pnpm exec antora antora-playbook.yml
pnpm exec docsearch ./docsearch.config.json
cd docs/search && docker compose -f typesense-compose.yml down
```

== GitHub Actions

`.github/workflows/search-reindex.yml` builds the docs, launches a short-lived Typesense container, runs the DocSearch scraper, and tears everything down. Configure secrets (`TYPESENSE_*`) to target remote clusters.

== Troubleshooting

* 401 from DocSearch – verify API key matches the Typesense config.
* Missing documents – ensure each AsciiDoc page declares `:page-tags:` and `:reviewed:`; `scripts/check-attrs.mjs` enforces this.
* Remote host unreachable – rerun with the local compose stack, then revisit firewall/VPC rules.
