= AI & Agent Workspace Playbook
:page-tags: diataxis:reference, domain:platform, audience:contrib, stability:beta
:reviewed: 2025-11-11

AI assistants (and ephemeral agent sessions) frequently attach to this
filesystem after the human operator has already been iterating. The notes below
make it trivial to recover context, detect the active Repo, and tidy up
submodules or untracked files before attempting an automation run.

== Workspace Topology

* *Super root*: `/Volumes/APFS Space/n00tropic/` (intentionally not a git Repo).
 It houses the federated `n00tropic-cerebrum/` Repo, the operational archive in
 `n00tropic_HQ/`, and shared automation under `.dev/`.
* *Primary git workspace*: `/Volumes/APFS Space/n00tropic/n00tropic-cerebrum/`
 with submodules for `n00t/`, `n00-frontiers/`, `n00-cortex/`, etc.
* *Automation scripts*: tracked inside
 `n00tropic-cerebrum/.dev/automation/scripts/`. Anything under the outer `.dev/`
 directory mirrors to local environments but is not versioned.
== Identify Your Repo Quickly

____ ✅ When in doubt, run the script below -- it enumerates the workspace root
plus every submodule. ____

[,bash]
----
./.dev/automation/scripts/workspace-health.sh --publish-artifact
----

* Use `git rev-parse --show-toplevel` from any path to confirm which Repo you are
 in.
* The script writes `artifacts/workspace-health.json`, which agents can parse to
 decide which submodule needs attention and whether the workspace root is
 ahead/behind origin.
== Sanity Checks & Auto-Remediation

|=== | Need | Command | Notes

| Snapshot workspace + publish machine-readable status |
`./.dev/automation/scripts/workspace-health.sh --publish-artifact --json` | JSON
goes to stdout *and* `artifacts/workspace-health.json`.

| Clean only-untracked noise (for example generated assets) safely |
`./.dev/automation/scripts/workspace-health.sh --clean-untracked` | Runs `git
clean -fd` for repos that have no tracked changes.

| Realign submodule pointers | `./.dev/automation/scripts/workspace-health.sh
--sync-submodules` | Equivalent to `git submodule sync && git submodule update
--init --recursive`.

| Run everything (submodules + trunk sync) |
`./.dev/automation/scripts/workspace-health.sh --fix-all` | Alias for the
previous two steps.

| Strict ci-style enforcement | Append `--strict-submodules --strict-root` |
Causes a non-zero exit when anything is dirty/diverged. |===

== n00t Capability: `workspace.gitDoctor`

* The capability manifest now exposes the script above at `workspace.gitDoctor`.
 It honours the following payload keys when invoked via `n00t``'s agent runner
 or MCP host: ** `cleanUntracked` → toggles `--clean-untracked`. **
 `syncSubmodules` → toggles `--sync-submodules`. ** `publishArtifact` → writes
 the JSON file to `artifacts/workspace-health.json`. ** `strict`/`check` →
 mirrors the CLI `--strict` flag for ci checks.
* Results are persisted automatically when the runner sets
 `CAPABILITY_PAYLOAD.output`, so agents always have a JSON artefact to inspect
 after the run.
=== Sample MCP payload

[,json]
----
{ "cleanUntracked": true, "syncSubmodules": true, "publishArtifact": true,
"strict": false
}
----

== Handling Dirty States Before Push

. *Root shows tracked changes to a submodule* (`workspace-health` prints
`+tracked 1 … n00t+`): ** Inspect the Repo: `git -C n00t status -sb`. **
Commit/push inside the submodule if the change is intentional, then commit the
pointer change at the root. ** Otherwise run `git submodule update --init
--recursive` to reset to the recorded revision. . *Root shows untracked files
only*: ** Use `--clean-untracked` (safe, because it skips repos with tracked
changes). . *Submodule behind/ahead*: ** `git -C <Repo> pull --ff-only` or `git
-C <Repo> push --force-with-lease` depending on the direction.

TIP: the JSON artifact exposes `tracked` vs `untracked` arrays per Repo, so an
agent can branch its remediation strategy programmatically.

== Agent-Friendly Checklist

. `workspace-health.sh --publish-artifact --json`. . Read
`artifacts/workspace-health.json` to determine the active Repo + remediation
path. . Run guarded cleaners (`--clean-untracked`) or `--sync-submodules` as
needed. . When invoked via MCP, prefer `workspace.gitDoctor` so the host
automatically records the output path.

Following the loop above removes the guesswork around submodules, untracked
files, and root vs submodule context before automation tries to run.
