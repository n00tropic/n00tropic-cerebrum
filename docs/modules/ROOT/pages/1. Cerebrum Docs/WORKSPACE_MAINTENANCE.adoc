= Workspace maintenance runbook
:page-tags: diataxis:reference, domain:platform, audience:contrib, stability:beta
:reviewed: 2025-11-18

This guide keeps the federated workspace healthy whether you are preparing a
pull request or refreshing a long-lived clone.

== 1. Assess the workspace

[,bash]
----
./.dev/automation/scripts/workspace-health.sh --strict-submodules --publish-artifact --json
----

* *Goal*: ensure every submodule is clean and aligned with its upstream.
* `--publish-artifact` writes the JSON snapshot to
 `artifacts/workspace-health.json` so agents and ci can import it without
 rerunning the script.
* Add `--sync-submodules` when reviving a stale clone, or `--fix-all` to run
 submodule + trunk sync together.
* Use `--clean-untracked` to drop generated files; it only runs `git clean
 -fd` inside repos that have no tracked changes.
* Use `--repo-cmd n00-cortex:"git status -sb"` for quick targeted diagnostics.
* See `AI_WORKSPACE_PLAYBOOK.md` for the agent-oriented cheatsheet (workspace
 topology, payload formats, and remediation flow).
== 2. Fix drift (if needed)

|=== | Scenario | Action

| Submodule has untracked changes you want to discard | `+git -C <Repo>
checkout -- .+` or run `+workspace-health --repo-cmd <Repo>:"git checkout --
."+`

| Submodule is behind | `git -C <Repo> pull --ff-only`

| Tooling configs diverged | `./.dev/automation/scripts/sync-trunk.py --pull`
(automatically included in `--fix-all`)

| Only untracked files remain (root or submodule) |
`./.dev/automation/scripts/workspace-health.sh --clean-untracked`

| Workspace root dirty | Commit or stash before release automation |===

== 3. Run cross-repo checks

[,bash]
----
./.dev/automation/scripts/meta-check.sh
----

This script runs schema validation, Renovate preset verification, CVE scans, and
other repo-specific linters.

== 4. Validate delivery artefacts

For any metadata-bearing document (ideas, jobs, projects):

[,bash]
----
./.dev/automation/scripts/project-preflight.sh --path <doc> --registry <optional registry override>
----

Preflight chains capture, GitHub sync, and ERPNext sync to confirm IDs, links,
and review cadence before you share updates.

== 5. Document and ship

. Capture relevant ADRs in `1. Cerebrum Docs/ADR/`. . Commit per-Repo changes
and push. . Run `./.dev/automation/scripts/workspace-release.sh` when tagging a
coordinated drop so release manifests stay in sync.

TIP: wire the workflow described earlier into automation pipelines (Trunk, ci) to fail fast
whenever the workspace drifts.

== Automation and agent quick reference

* Preferred capability: `workspace.gitDoctor` (backed by `workspace-health.sh`).
 Payload keys include `cleanUntracked`, `syncSubmodules`, `publishArtifact`, and
 `strict`.
* Automation emits `artifacts/workspace-health.json`, which distinguishes tracked
 vs untracked entries per Repo so agents can react programmatically.
* Additional context and sample payload LIVE in xref:++1. Cerebrum
 Docs/AI_WORKSPACE_PLAYBOOK.adoc++[`AI_WORKSPACE_PLAYBOOK.md`].
